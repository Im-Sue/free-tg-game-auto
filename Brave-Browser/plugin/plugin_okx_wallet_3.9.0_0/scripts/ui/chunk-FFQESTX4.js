import{a as ie,b as le}from"./chunk-5TNZ4MQV.js";import{d as oe}from"./chunk-R7VTXTCL.js";import{t as J}from"./chunk-5JJQQHKZ.js";import{p as Z,q as v,r as b}from"./chunk-URG4MCPH.js";import{Ba as z,Pa as X,Sa as Y,y as He}from"./chunk-ZPOCIBPN.js";import{a as qe}from"./chunk-IOCZ22XI.js";import{j as I,o as Ve}from"./chunk-EJY3MW2I.js";import{c as O,d as W,f as Ue}from"./chunk-2G2AXMFT.js";import{a as ee,b as re,c as te,d as ne,e as ae}from"./chunk-XGFQCNHX.js";import{a as se,b as ce}from"./chunk-JERFAOJH.js";import{c as M,e as h}from"./chunk-FQ4XEVKF.js";import{a as Q,b as Ke}from"./chunk-A7LNVEYU.js";import{f as G,h as Pe}from"./chunk-2YWUVAR3.js";import{Tb as $,_b as A,la as V,m as Le,o as N,q as K,r as H,v as q}from"./chunk-M54COW6Q.js";import{H as C}from"./chunk-RIJWHGTU.js";import{I as Re,v as T}from"./chunk-K4MPEKC5.js";import{a as De}from"./chunk-CXUPEGDW.js";import{c as E,f as F,m as d,o as u}from"./chunk-ICCOEXX5.js";var ue=E((pr,de)=>{"use strict";d();u();de.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,r=>`%${r.charCodeAt(0).toString(16).toUpperCase()}`)});var ge=E((gr,ye)=>{"use strict";d();u();var me="%[a-f0-9]{2}",fe=new RegExp(me,"gi"),pe=new RegExp("("+me+")+","gi");function B(e,r){try{return decodeURIComponent(e.join(""))}catch{}if(e.length===1)return e;r=r||1;var t=e.slice(0,r),n=e.slice(r);return Array.prototype.concat.call([],B(t),B(n))}function Ge(e){try{return decodeURIComponent(e)}catch{for(var r=e.match(fe),t=1;t<r.length;t++)e=B(r,t).join(""),r=e.match(fe);return e}}function Qe(e){for(var r={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},t=pe.exec(e);t;){try{r[t[0]]=decodeURIComponent(t[0])}catch{var n=Ge(t[0]);n!==t[0]&&(r[t[0]]=n)}t=pe.exec(e)}r["%C2"]="\uFFFD";for(var a=Object.keys(r),c=0;c<a.length;c++){var s=a[c];e=e.replace(new RegExp(s,"g"),r[s])}return e}ye.exports=function(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch{return Qe(e)}}});var We=E((Ar,we)=>{"use strict";d();u();we.exports=(e,r)=>{if(!(typeof e=="string"&&typeof r=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(r==="")return[e];let t=e.indexOf(r);return t===-1?[e]:[e.slice(0,t),e.slice(t+r.length)]}});var he=E((xr,Ae)=>{"use strict";d();u();Ae.exports=function(e,r){for(var t={},n=Object.keys(e),a=Array.isArray(r),c=0;c<n.length;c++){var s=n[c],o=e[s];(a?r.indexOf(s)!==-1:r(s,o,e))&&(t[s]=o)}return t}});var Me=E(f=>{"use strict";d();u();var ze=ue(),Xe=ge(),xe=We(),Ye=he(),Je=e=>e==null,D=Symbol("encodeFragmentIdentifier");function Ze(e){switch(e.arrayFormat){case"index":return r=>(t,n)=>{let a=t.length;return n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),"[",a,"]"].join("")]:[...t,[l(r,e),"[",l(a,e),"]=",l(n,e)].join("")]};case"bracket":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),"[]"].join("")]:[...t,[l(r,e),"[]=",l(n,e)].join("")];case"colon-list-separator":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),":list="].join("")]:[...t,[l(r,e),":list=",l(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{let r=e.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,a)=>a===void 0||e.skipNull&&a===null||e.skipEmptyString&&a===""?n:(a=a===null?"":a,n.length===0?[[l(t,e),r,l(a,e)].join("")]:[[n,l(a,e)].join(e.arrayFormatSeparator)])}default:return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,l(r,e)]:[...t,[l(r,e),"=",l(n,e)].join("")]}}function ve(e){let r;switch(e.arrayFormat){case"index":return(t,n,a)=>{if(r=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),!r){a[t]=n;return}a[t]===void 0&&(a[t]={}),a[t][r[1]]=n};case"bracket":return(t,n,a)=>{if(r=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"colon-list-separator":return(t,n,a)=>{if(r=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"comma":case"separator":return(t,n,a)=>{let c=typeof n=="string"&&n.includes(e.arrayFormatSeparator),s=typeof n=="string"&&!c&&y(n,e).includes(e.arrayFormatSeparator);n=s?y(n,e):n;let o=c||s?n.split(e.arrayFormatSeparator).map(g=>y(g,e)):n===null?n:y(n,e);a[t]=o};case"bracket-separator":return(t,n,a)=>{let c=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!c){a[t]=n&&y(n,e);return}let s=n===null?[]:n.split(e.arrayFormatSeparator).map(o=>y(o,e));if(a[t]===void 0){a[t]=s;return}a[t]=[].concat(a[t],s)};default:return(t,n,a)=>{if(a[t]===void 0){a[t]=n;return}a[t]=[].concat(a[t],n)}}}function Ee(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function l(e,r){return r.encode?r.strict?ze(e):encodeURIComponent(e):e}function y(e,r){return r.decode?Xe(e):e}function Fe(e){return Array.isArray(e)?e.sort():typeof e=="object"?Fe(Object.keys(e)).sort((r,t)=>Number(r)-Number(t)).map(r=>e[r]):e}function Te(e){let r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function er(e){let r="",t=e.indexOf("#");return t!==-1&&(r=e.slice(t)),r}function Ce(e){e=Te(e);let r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function Ie(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function be(e,r){r=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},r),Ee(r.arrayFormatSeparator);let t=ve(r),n=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return n;for(let a of e.split("&")){if(a==="")continue;let[c,s]=xe(r.decode?a.replace(/\+/g," "):a,"=");s=s===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?s:y(s,r),t(y(c,r),s,n)}for(let a of Object.keys(n)){let c=n[a];if(typeof c=="object"&&c!==null)for(let s of Object.keys(c))c[s]=Ie(c[s],r);else n[a]=Ie(c,r)}return r.sort===!1?n:(r.sort===!0?Object.keys(n).sort():Object.keys(n).sort(r.sort)).reduce((a,c)=>{let s=n[c];return Boolean(s)&&typeof s=="object"&&!Array.isArray(s)?a[c]=Fe(s):a[c]=s,a},Object.create(null))}f.extract=Ce;f.parse=be;f.stringify=(e,r)=>{if(!e)return"";r=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},r),Ee(r.arrayFormatSeparator);let t=s=>r.skipNull&&Je(e[s])||r.skipEmptyString&&e[s]==="",n=Ze(r),a={};for(let s of Object.keys(e))t(s)||(a[s]=e[s]);let c=Object.keys(a);return r.sort!==!1&&c.sort(r.sort),c.map(s=>{let o=e[s];return o===void 0?"":o===null?l(s,r):Array.isArray(o)?o.length===0&&r.arrayFormat==="bracket-separator"?l(s,r)+"[]":o.reduce(n(s),[]).join("&"):l(s,r)+"="+l(o,r)}).filter(s=>s.length>0).join("&")};f.parseUrl=(e,r)=>{r=Object.assign({decode:!0},r);let[t,n]=xe(e,"#");return Object.assign({url:t.split("?")[0]||"",query:be(Ce(e),r)},r&&r.parseFragmentIdentifier&&n?{fragmentIdentifier:y(n,r)}:{})};f.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[D]:!0},r);let t=Te(e.url).split("?")[0]||"",n=f.extract(e.url),a=f.parse(n,{sort:!1}),c=Object.assign(a,e.query),s=f.stringify(c,r);s&&(s=`?${s}`);let o=er(e.url);return e.fragmentIdentifier&&(o=`#${r[D]?l(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${t}${s}${o}`};f.pick=(e,r,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[D]:!1},t);let{url:n,query:a,fragmentIdentifier:c}=f.parseUrl(e,t);return f.stringifyUrl({url:n,query:Ye(a,r),fragmentIdentifier:c},t)};f.exclude=(e,r,t)=>{let n=Array.isArray(r)?a=>!r.includes(a):(a,c)=>!r(a,c);return f.pick(e,n,t)}});d();u();var x=F(Me()),i=F(De()),p=F(He()),L=F(qe());Ve();Re();Ue();d();u();var Se=()=>!!(window.navigator&&window.navigator.hid);V();d();u();var S=F(Le());V();var rr=(e=[],r)=>{let t={};return e.forEach(n=>{t[n[r]]=n}),t},Oe=(e,r)=>{if(!e||!Array.isArray(e))return[];let{hasBackup:t,keyringType:n}=r||{};return e.filter(({hasBackup:a,keyringIdentityType:c})=>{let s=!0;return typeof t=="boolean"&&(s=t===a),n&&(s=(typeof n=="string"?[n]:n)?.includes(c)),s})},Ne=e=>e?.reduce((r,{walletIdentities:t,...n})=>[...r,...t.map((a={})=>({...n,...a}))],[]),_e=e=>e.map(r=>{let{walletIdentities:t}=r;return{...r,hasBackup:!t?.[0]?.backupData?.length}}),tr=(e={},r)=>{let t=[$.SEGWIT_NESTED,$.SEGWIT_NESTED_49],n={};return Object.keys(e).forEach(c=>{let s=r[c],o=t.find(m=>m!==s),g=Object.entries(e[c]).map(([m,k])=>({addressType:m,...k}));n[c]=g.filter(({addressType:m})=>m!==o)}),n},je=(e=[],r=[])=>{let t=rr(r,"walletId");return e.map(n=>{let{walletIdentities:a}=n;return{...n,walletIdentities:a.map(c=>{let{walletId:s,accountsMap:o,addressType:g,...m}=c;if(!t[s])return{walletId:s,addressType:{},...m};let{addressType:k,segwitAddressType:Be}=t[s];return{walletId:s,selectedAddressType:k,addressType:tr(c?.accountsMap,Be),...m}})}})};var nr=[K,q,H],kr=(e,r=N,t)=>{if(nr.includes(r)&&t){let a=e?.addressType?.[r]||[];return(0,S.find)(a,c=>c.addressType===t)?.address}return e?.account?.[r]};d();u();Ke();Pe();var ke=()=>({syncMpcWallet:async r=>{let t=r?.walletIdentities?.length||0,n=r?.mpcId||"",{data:a}=await G(Q.syncMpcwallet,{mpcId:n,deriveIndex:t});return a}});var ar="syncMpcWalletErrorCode",it=()=>(0,p.useSelector)(Y),sr=z(({metamask:e})=>{let{wallets:r,keyringIdentities:t}=e;return{wallets:r,keyringIdentities:t}},({wallets:e,keyringIdentities:r})=>je(r,e)),U=e=>{let r=(0,p.useSelector)(sr);return(0,i.useMemo)(()=>{let n=_e(r);return e?Oe(n,e):n},[e,r])},_=e=>{let r=U(e);return(0,i.useMemo)(()=>Ne(r||[]),[r])},cr=()=>(0,p.useSelector)(X),P=(e,r=!0)=>{let t=cr(),n=e||t,a=_();return(0,i.useMemo)(()=>r===!1&&!e?null:a.find(c=>c?.walletId===n),[a,n,r,e])},lt=(e,r)=>{let t=_(r);return(0,i.useMemo)(()=>Array.isArray(e)?t.filter(({walletId:n})=>e.includes(n)):t,[e,t])},dt=()=>{let e=_();return(0,i.useCallback)(r=>e?.find(t=>t.walletId===r),[e])},ut=e=>P(e)?.keyringIdentityType===A.MPC,ft=e=>{let r=P(e);return ae(r?.initialType)},pt=e=>{let r=U(),{keyringId:t}=P()||{},n=e||t;return(0,i.useMemo)(()=>r?.find(a=>a.keyringId===n),[r,n])},j=()=>{let e=U();return(0,i.useCallback)(r=>e?.find(t=>t.keyringId===r),[e])};var $e=()=>{let e=(0,p.useDispatch)();return(0,i.useCallback)(async r=>{try{let{walletId:t}=await W().addNewWallet(r);return await I(e),C.success({title:T("wallet_addacount_toast_account_created")}),t}catch(t){return t.message===ie&&C.error(T("wallet_home_toast_network_error")),t.message===le&&C.error(T("extension_wallet_addwallet_toast_wallets_added",{amount:500})),""}},[])},or=()=>{let e=(0,L.useHistory)();return(0,i.useCallback)(async r=>{let t=r?.walletIdentities?.[0]?.walletId;if(!Se()){e.push(`${b}/${M.ledger}?${x.default.stringify({baseChain:N,type:h.addAccount,walletId:t})}`);return}let n=`${v}?${x.default.stringify({type:h.addAccount,walletId:t})}`;await oe.hasConnectedLedger()?e.push(n):ce.openModal(se.hardWareNotConnected,{walletName:r.keyringName,onButtonClick:()=>{globalThis.platform.openExtensionInBrowser(Z)},onExtButtonClick:()=>{globalThis.platform.openExtensionInBrowser(`${n}&hideBack=1`)}})},[])},ir=()=>{let e=(0,L.useHistory)(),r=or(),t=_()?.length;return(0,i.useCallback)(async n=>{if(t===500){C.error(T("extension_wallet_addwallet_toast_wallets_added",{amount:500}));return}let{initialType:a}=n,c=n?.walletIdentities?.[0]?.walletId;switch(!0){case ee(a):{r(n);break}case re(a):{globalThis.platform.openExtensionInBrowser(`${b}/${M.trezor}?${x.default.stringify({type:h.addAccount,walletId:c,hideBack:1})}`);break}case te(a):{e.push(`${b}/${M.keystone}?${x.default.stringify({walletId:c,type:h.addAccount})}`);break}case ne(a):{let{onekeyInfo:s}=n,{firstEvmAddress:o,connectId:g}=s;e.push(`${b}/${M.onekey}?${x.default.stringify({firstEvmAddress:o,connectId:g,type:h.addAccount})}`);break}default:break}},[])},mt=()=>{let e=j(),r=$e(),t=ir(),n=$e(),{syncMpcWallet:a}=ke();return(0,i.useCallback)(async c=>{if(c&&typeof c=="string"){let s=e(c),o=s?.walletIdentities?.[0]?.walletId;if(s?.keyringIdentityType===A.MNEMONIC)return await r(o);if(s?.keyringIdentityType===A.HARDWARE)return t(s);if(s?.keyringIdentityType===A.MPC){try{await a(s)}catch{return Promise.reject(new Error(ar))}return await n(o)}return Promise.reject()}return Promise.reject()},[e,r,t,n,a])},lr=()=>{let e=j();return(0,i.useCallback)(r=>new Promise((t,n)=>{let a=e(r);O().getMnemonicByWalletId(a?.walletIdentities?.[0]?.walletId,(c,s)=>{if(c){n(c);return}t(s)})}),[])},yt=(e,r=!0)=>{let t=lr(),[n,a]=(0,i.useState)(null);return(0,i.useEffect)(()=>{(async()=>{if(e){let c=await t(e);a(c)}})()},[e]),r?n?.split(" "):n},dr=()=>(0,i.useCallback)((e,r={})=>new Promise((t,n)=>{O().getBackupPrivateKeys(e,(a,c)=>{if(a){n(a);return}let s=c;Array.isArray(r?.exclude)&&(s=s?.filter(({coinId:o})=>!r?.exclude?.includes(o))),t(s)})}),[]),gt=(e,r={})=>{let[t,n]=(0,i.useState)([]),a=dr();return J(()=>{(async()=>{if(e){let c=await a(e,r);n(c)}})()},[e,r]),t},ur=()=>{let e=j();return(0,i.useCallback)(r=>new Promise((t,n)=>{let a=e(r);O().getBackupData(a?.walletIdentities?.[0]?.walletId,(c,s)=>{if(c){n(c);return}t(s)})}),[])},wt=e=>{let[r,t]=(0,i.useState)([]),n=ur();return(0,i.useEffect)(()=>{(async()=>{if(e){let a=await n(e);t(a)}})()},[e]),r},Wt=()=>{let e=(0,p.useDispatch)(),r=j();return(0,i.useCallback)(async t=>{let n=r(t);await W().backupMnemonic(n?.walletIdentities?.[0]?.walletId),await I(e)},[])},At=()=>{let e=(0,p.useDispatch)();return(0,i.useCallback)(async(r,t)=>{await W().updateKeyringIdentityName(r,t),await I(e)},[])},ht=()=>{let e=(0,p.useDispatch)();return(0,i.useCallback)(async(r,t)=>{await W().updateWalletIdentityName(r,t),await I(e)},[])},It=()=>{let e=(0,p.useDispatch)();return(0,i.useCallback)(async r=>{await W().updateAllKeyringIdentities(r),await I(e)},[e])};export{Me as a,Se as b,kr as c,ar as d,it as e,U as f,_ as g,cr as h,P as i,lt as j,dt as k,ut as l,ft as m,pt as n,j as o,mt as p,yt as q,dr as r,gt as s,wt as t,Wt as u,At as v,ht as w,It as x};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-FFQESTX4.js.map
