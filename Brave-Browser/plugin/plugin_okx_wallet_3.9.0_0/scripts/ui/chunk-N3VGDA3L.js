import{a as st}from"./chunk-DZDHGH5B.js";import{c as Ae,d as be}from"./chunk-UKFSUXAE.js";import{a as oe}from"./chunk-4C2576LU.js";import{b as at}from"./chunk-QUUI62AZ.js";import{ba as Be}from"./chunk-VX7CI7XT.js";import{e as j,h as Ee,j as rt}from"./chunk-UIABO6UG.js";import{h as ne,k as Ie,l as Ue,r as Pe,s as ot}from"./chunk-FFQESTX4.js";import{F as nt}from"./chunk-CFT6B56M.js";import{a as Rt}from"./chunk-Q7FJER56.js";import{b as te}from"./chunk-AO6MUSOH.js";import{i as Fe,s as Ze,t as $e,x as O}from"./chunk-SJIW4WAV.js";import{a as L,j as et,l as G,o as le,t as tt}from"./chunk-5JJQQHKZ.js";import{Ha as ze,ab as Qe,y as wt}from"./chunk-ZPOCIBPN.js";import{R as Se,b as Ne}from"./chunk-CA5MYYD6.js";import{d as ue,f as Pt}from"./chunk-2G2AXMFT.js";import{c as b}from"./chunk-VMYDP774.js";import{a as Q,b as Bt}from"./chunk-A7LNVEYU.js";import{f as z,h as bt}from"./chunk-2YWUVAR3.js";import{Ea as Xe,Ka as Ye,Lb as ee,Pa as He,Pb as me,Qa as Ge,Ra as Ve,S as We,Sa as qe,Za as Je,gc as T,la as At,m as Ut,pb as he,q as Ce}from"./chunk-M54COW6Q.js";import{H as Ke,b as ye,o as ce,r as De}from"./chunk-RIJWHGTU.js";import{I as ge,l as K,v as y}from"./chunk-K4MPEKC5.js";import{X as $,c as Me}from"./chunk-XIGC6FD5.js";import{a as ie}from"./chunk-CXUPEGDW.js";import{a as Et}from"./chunk-RYJHESAH.js";import{f as v,m as P,n as w,o as E}from"./chunk-ICCOEXX5.js";P();E();var N=v(ie()),Tt=v(wt()),k=v(Et());var gt=v(Ut()),yt=v(Rt());ge();Pt();He();At();Bt();bt();he();P();E();var q=v(ie());P();E();He();he();function Mt(e,t,s,n,o=4){return L(async(a,u)=>{let i=0;for(let r=0;r<o;r++){let c=await e(a,void 0,{tempFeeRate:Number(u.expectedFeeRate)});if(!c.length)return[];i=c.reduce((l,_)=>l+_.coinAmount,0);let m=await t({inputs:c,outputs:[{address:s,amount:n}],dustSize:i});if(i-(m+Number(u.increaseFee))>n)return[!0,!1,c,m];if(i>n&&r===o-1)return m=i-n,[!1,!0,c,m]}return[]})}function it(e){let[t,s]=(0,q.useState)({}),[n,o]=(0,q.useState)(0),[a,u]=(0,q.useState)([]),{mainCoinId:i,address:r,btcSpeedUpInfo:c,txHash:m,canAccelerateBtcTx:p}=e,l=i,_=j(l),d=(0,q.useMemo)(()=>c?.cpfpSpeedUpUtxo?.map(g=>`${g.txHash}-${g.vout}`),[c]),[,x]=st({coinId:l,address:r,chainId:_?.chainId},{pollingInterval:20*1e3,ready:p}),f=x?.minOutput||0,h=de({coinId:l,fromAddr:r,output:[{to:r,value:f}],satBytes:t?.expectedFeeRate}),U=_e({coinId:l,address:r,utxoType:V.ACCELERATE_BTC_TX_UTXO,speedUpNeedUtxo:d});if(G(async()=>{if(l===Ye){let g=await nt({address:r,coinId:l,txHash:m});s(g);let F=await U(0,void 0,{tempFeeRate:t.expectedFeeRate});u(F)}},{pollingInterval:20*1e3}),t?.expectedFeeRate&&a.length){let g=a.reduce((F,B)=>F+B.coinAmount,0);h({inputs:a,outputs:[{address:r,amount:f}],satBytes:t.expectedFeeRate,dustSize:g}).then(F=>{let B=qe(F,Number(t.increaseFee),f);o(B)}).catch(F=>{throw F})}let C=Mt(U,h,r,f);return[n,t,f,C]}P();E();var _t=v(Me());ge();var A=v(ie());P();E();var S=v(ie()),xe=v(Me());he();ge();P();E();var I={root:"_root_rjjjg_1",subTitle:"_subTitle_rjjjg_4",utxo:"_utxo_rjjjg_9",coin:"_coin_rjjjg_17",coinDetail:"_coinDetail_rjjjg_23",coinSymbol:"_coinSymbol_rjjjg_29",nftImage:"_nftImage_rjjjg_35",coinAmount:"_coinAmount_rjjjg_38",coinValue:"_coinValue_rjjjg_43",assetList:"_assetList_rjjjg_51",unresolvedTip:"_unresolvedTip_rjjjg_51",list:"_list_rjjjg_58",paddingTop:"_paddingTop_rjjjg_61",asset:"_asset_rjjjg_51",assetDetail:"_assetDetail_rjjjg_71",assetValue:"_assetValue_rjjjg_72",foldSwitch:"_foldSwitch_rjjjg_86",fold:"_fold_rjjjg_86"};var J=e=>[T.ARC_NFT,T.BRC_NFT,T.DRC_NFT,T.SRC_NFT].includes(e),lt=e=>J(e?.protocolId)?`${e.collectionName||""} ${e.inscriptionNumber||e.nftId||""}`:$e(e.tokenAmount||"",{symbol:e.tokenSymbol||""}),pt=({asset:e,selectedCurrency:t,className:s})=>S.default.createElement(O.Text,{ellipsis:{tooltip:!0},className:s},Je(e.usdAmount,0)?y("extension_defi_card_text_unknown_value"):Ze(K.mul(e.usdAmount,t.usdToThisRate),{symbol:t.symbol,useApproximate:!1})),Dt=({assetList:e,assetUnknown:t,selectedCurrency:s})=>{let n=e.length>3,[o,{toggle:a}]=le(n),u=o?e.slice(0,3):e,i=!!t?.length;return S.default.createElement(b.Box,{className:I.assetList},i&&S.default.createElement(O.Text,{className:I.unresolvedTip},y("extension_defi_mid_alert_utxo_not_decode",{asset:t.join(y("extension_wallet_text_punctuation_mark"))})),u?.length?S.default.createElement(b.Box,{className:(0,xe.default)(I.list,{[I.paddingTop]:!i})},u.map(r=>S.default.createElement(b.Box,{className:I.asset},S.default.createElement(O.Text,{ellipsis:{tooltip:!0},className:I.assetDetail},lt(r)),S.default.createElement(pt,{asset:r,className:I.assetValue,selectedCurrency:s})))):null,!!n&&S.default.createElement(b.Box,{align:b.ALIGN.center,className:(0,xe.default)(I.foldSwitch,{[I.fold]:o}),onClick:a},S.default.createElement(b.Box,null,y(o?"extension_defi_card_textbtn_view_all":"extension_defi_card_textbtn_view_less")),S.default.createElement(te,{className:"okx-wallet-plugin-add-arrow-chevrons"})))},Kt=({title:e,utxoList:t,selectedCurrency:s})=>S.default.createElement(b.Box,{className:I.root},S.default.createElement(O.Text,{className:I.subTitle},e),t.map(n=>{let{mainAsset:o,protocolAssetList:a,assetUnknown:u}=n;return S.default.createElement(b.Box,{className:I.utxo},S.default.createElement(b.Box,{className:I.coin},S.default.createElement(b.Box,{className:I.coinDetail},S.default.createElement(te,{className:(0,xe.default)(I.coinSymbol,{[I.nftImage]:J(o.protocolId)}),radius:!1,size:J(o.protocolId)?Fe.sm:Fe.xs,src:o.image,text:o.tokenSymbol}),S.default.createElement(O.Text,{ellipsis:{tooltip:!0},className:I.coinAmount},lt(o))),S.default.createElement(pt,{className:I.coinValue,asset:o,selectedCurrency:s})),S.default.createElement(Dt,{assetList:a,assetUnknown:u,selectedCurrency:s}))})),Re=Kt;P();E();var R={root:"_root_v0mp8_1",header:"_header_v0mp8_7",back:"_back_v0mp8_14",main:"_main_v0mp8_17",title:"_title_v0mp8_23",text:"_text_v0mp8_29",checkBox:"_checkBox_v0mp8_34",footerWrap:"_footerWrap_v0mp8_37",tipMessage:"_tipMessage_v0mp8_43",submitButton:"_submitButton_v0mp8_47"};var Wt=({conflictAssetUtxo:e,unlockFeeUtxo:t,selectedCurrency:s,protocolId:n,onConfirm:o,onCancel:a,coin:u,psbtTitle:i=""})=>{let[r,c]=(0,A.useState)(!1),m=(0,A.useRef)(),[p,l]=(0,A.useState)(!1);return et(()=>{l(at(m.current,"vertical"))}),A.default.createElement(b.Box,{className:R.root},A.default.createElement(b.Box,{className:R.header},A.default.createElement(te,{className:(0,_t.default)(R.back,"okds-arrow-chevron-left-centered-md"),onClick:a})),A.default.createElement(b.Box,{ref:m,className:R.main},A.default.createElement(b.Box,{className:R.title},A.default.createElement(O.Text,{className:R.text},y("extension_defi_top_title_confirm_use_utxo"))),!!e.length&&A.default.createElement(Re,{title:J(n)?y("extension_defi_top_subtitle_utxo_lose_all_assets_nft"):y("extension_defi_top_subtitle_utxo_lose_all_assets",{token:u.symbol}),utxoList:e,selectedCurrency:s}),!!t.length&&A.default.createElement(Re,{title:i||([T.ARC_20,T.RUNES,T.BRC_20,T.RUNEMAIN].includes(n)||J(n)?y("extension_defi_mid_subtitle_utxo_cover_fee"):y("extension_defi_top_subtitle_use_utxo_lose_assets")),utxoList:t,selectedCurrency:s}),A.default.createElement(De,{className:R.checkBox,onChange:_=>{let d=_?.target?.checked;c(d)},checked:r},y("extension_defi_bot_checkbox_label_confirm_use_utxo"))),A.default.createElement(b.Box,{className:R.footerWrap},!r&&A.default.createElement(ye,{desc:y(p?"extension_defi_bot_tips_slide_check_box":"extension_defi_bot_tips_confirm_check_box"),type:ye.TYPE.info,closable:!1,className:R.tipMessage}),A.default.createElement($,{block:!0,className:R.submitButton,disabled:!r,category:$.CATEGORY.fill,size:$.SIZE.lg,type:$.TYPE.highlight,onClick:o},y("extension_defi_bot_btn_continue"))))},dt=Wt;P();E();P();E();var V={TRANSFER:1,TRANSFER_NFT:2,COMPLETE:3,BRC20_CONVERTIBLE:4,NFT_REMOVAL:5,PSBT_DUMMY_OCCUPIED:6,EXPEND_ABLE:7,EXPEND_UNABLE:8,INSCRIPTION:9,BRC20S_CONVERTIBLE:4,NEW_INSCRIPTION:11,SPLIT_UTXO:13,INSCRIPTION_USE_NFT_UTXO:14,ACCELERATE_BTC_TX_UTXO:15},W={CAL_FEE:1,CONFIRM:2},M=546,X={INSCRIBE:1,PSBT:2,PSBT_MPC_UNSIGNED_LIST:21,PSBT_MPC_SIGNED_LIST:22,PSBT_MPC_UNSIGNED_BUY:23,PSBT_MPC_SIGNED_BUY:24,PSBT_MPC_UNSIGNED:25,PSBT_KEY_SCRIPT_PATH:3,PSBT_KEY_SCRIPT_PATH_BATCH:4,SRC20:101,RUNES:102,RUNEMAIN:103,ARC20:114},Z={TRANSFER:1,PSBT:2,ACCELERATE:3};var Xt={BRC20:1,SRC20:101},ve=e=>{if(e===T.SRC_20)return X.SRC20;if(e===T.ARC_20)return X.ARC20;if(e===T.RUNES)return X.RUNES;if(e===T.RUNEMAIN)return X.RUNEMAIN},Yt=({data:e,nftLocaltionVOs:t},s)=>Array.isArray(e)&&e?.length?{data:e}:!s||!t?.[0]?.nftId||!Array.isArray(t)?{}:s===T.ARC_20?{data:t.map(({nftId:n,tokenType:o,value:a})=>({atomicalId:n,type:o,amount:a}))}:s===T.RUNES?{data:t.map(({nftId:n,value:o})=>({id:n,amount:o}))}:s===T.RUNEMAIN?{data:t.map(({nftId:n,value:o})=>({id:n,amount:o}))}:{},re=(e,t={},s)=>Array.isArray(e)?e.map(({txHash:n,vout:o,coinAmount:a,rawTransaction:u,...i})=>({vOut:o,amount:a,txId:n,rawTransaction:u,...Yt(i,s),...t})):[],xt=(e={},t,s)=>{let n=s===Xt.BRC20?"text/plain;charset=utf-8":"stamp:",o=e?.revealAddr,a=e?.contentType;return a||(a=n),o||(o=t),{...e,revealAddr:o,contentType:a}},ft=({type:e,toAddr:t,fromAddr:s,satBytes:n,utxoList:o,privateKey:a,inscriptionData:u,inscriptionDataList:i,revealOutValue:r=M})=>({type:e,revealOutValue:r,changeAddress:s,commitFeeRate:n,revealFeeRate:n,commitTxPrevOutputList:re(o,{privateKey:a,address:s}),inscriptionData:xt(u,t||s,e),inscriptionDataList:i?.length?i.map(c=>xt(c,t||s,e)):void 0}),Ht=({changeAddr:e,toAddr:t,satBytes:s,utxoList:n=[],coinAmount:o,inputs:a,outputs:u,...i})=>({address:e,feePerB:s,inputs:re([...a||[],...n]),outputs:u||[{address:t,amount:o}],...i}),Gt=({changeAddr:e,toAddr:t,satBytes:s,utxoList:n=[],coinAmount:o,inputs:a,outputs:u,protocolId:i,fromAddr:r,...c})=>{let m={feePerB:s,address:e,inputs:re([...a||[],...n],{address:r||e},i),outputs:u||[{address:t,amount:o}],...c};return i===T.RUNES&&Object.assign(m,{runeData:{etching:null,burn:!1}}),i===T.RUNEMAIN&&Object.assign(m,{runeData:{etching:null,burn:!1,useDefaultOutput:!1,defaultOutput:0}}),m},Vt=e=>[T.SRC_20,T.ARC_20,T.RUNES,T.RUNEMAIN].includes(e),pe=({toAddr:e,changeAddr:t,satBytes:s,utxoList:n=[],coinAmount:o,inputs:a,outputs:u,protocolId:i,...r})=>Vt(i)?Gt({toAddr:e,changeAddr:t,satBytes:s,utxoList:n,coinAmount:o,inputs:a,outputs:u,protocolId:i,...r}):Ht({toAddr:e,changeAddr:t,satBytes:s,utxoList:n,coinAmount:o,inputs:a,outputs:u,...r});var _e=e=>{let{coinId:t,address:s,walletId:n,utxoType:o,satBytes:a,utxoRequests:u=[],...i}=e,r=j(t),c=r?.baseCoinId||r?.coinId;return L(async(m,p,l={})=>{let _=await ue().getRequestHeaders({walletId:n,needSign:!0,currency:"usd"}),d={coinId:c,utxoRequests:[{address:s,coinAmount:m,serviceCharge:p,utxoType:o||V.TRANSFER,...i,...l},...u]};try{let{data:x}=await z(Q?.getBTCUTXO,d,{headers:_}),{utxoList:f}=x?.[0]||{};return f}catch(x){return Promise.reject(x)}},[c,s,n,o,i])},qt=[],ct=(e,t)=>{let{ready:s=!0,refreshDeps:n=[],...o}=t||{},{coinAmount:a="0",networkFee:u="0",...i}=e||{},r=_e(i),c={debounceWait:500,ready:s&&i?.address&&i?.walletId,refreshDeps:[a,u,r,...n],...o},{error:m,loading:p,data:l}=G(async()=>await r(a,u),c);return[p,l||qt,m]},we=()=>L(async({coinId:e,baseCoinId:t,satBytes:s,addressList:n,walletId:o,utxoType:a,...u})=>{let i=await ue().getRequestHeaders({walletId:o,needSign:!0,currency:"usd"}),r=Array.isArray(n)?n:[n],c={coinId:t,utxoRequests:r.map(m=>({address:m,coinAmount:0,serviceCharge:0,utxoType:a||V.TRANSFER,...u}))};try{let{data:m}=await z(Q?.getBTCUTXO,c,{headers:i});return r.map(p=>{let{canTransferAmount:l}=m.find(_=>_.address===p);return l})}catch(m){return Promise.reject(m)}}),vt=(e={},t)=>{let{address:s,coinId:n,...o}=e,{ready:a=!0,...u}=t||{},i=we(),r=j(n),{loading:c,data:m,error:p}=G(async()=>{try{return(await i({addressList:[s],baseCoinId:r.baseCoinId||n,coinId:n,...o}))?.[0]||"0"}catch{return"0"}},{ready:!!s&&a&&r?.baseCoinId!==void 0,...u});return[c,m,p]},kt=(e={},t)=>{let{addressList:s,coinId:n,...o}=e,{ready:a=!0,...u}=t||{},i=we(),r=j(n),{loading:c,data:m,error:p}=G(async()=>await i({addressList:s,baseCoinId:r.baseCoinId||n,coinId:n,...o}),{ready:Array.isArray(s)&&s?.length&&a&&r?.baseCoinId!==void 0,...u});return[c,m||[],p]},Jt=0,ut=()=>L((e,t)=>(e||[]).some(n=>n.status===Jt)?new Promise((n,o)=>{let a=ce.warn({alignBottom:!1,title:y("extension_wallet_transaction_title_low_tradingfee"),text:y("extension_wallet_transaction_subtitle_low_tradingfee"),confirmText:y("wallet_extension_address_popup_btn_continue"),cancelText:y("wallet_extension_btn_general_cancel"),onCancel:()=>{a.destroy(),o(),t?.()},onConfirm:()=>{a.destroy(),n()}})}):Promise.resolve(),[]),Zt=(e,t)=>{let[,s]=Ee(t);return L(async n=>{if(s?.coinId!==We)return Promise.resolve();let{data:o}=await z(Q.checkWalletCommonPending,{address:e,coinId:t});return o?new Promise((a,u)=>{let i=ce.warn({alignBottom:!1,title:y("extension_defi_mid_title_reminder"),text:y("extension_defi_mid_subtitle_reminder_submit"),confirmText:y("extension_defi_mid_btn_cancel"),onConfirm:()=>{i.destroy(),u(),n?.()},cancelText:y("extension_defi_mid_btn_continue_submit"),onCancel:()=>{i.destroy(),a()}})}):Promise.resolve()})},$t=({address:e,coinId:t,protocolId:s,txType:n=Ne.TRANS_OUT,doubleConfirmSource:o=Z.TRANSFER})=>{let[a,u]=Ee(t,{withPrice:!0});a=a||{},u=u||{};let i=(0,Tt.useSelector)(Qe),{currencyId:r}=i,c=rt({currencyId:r});return L(async m=>{let p={};return m.forEach(({txHash:l,resourceUrl:_})=>{p[l]=_}),new Promise((l,_)=>{(async()=>{try{let{data:{conflictAssetUtxo:d,unlockFeeUtxo:x}}=await z(Q.doubleCheckUtxo,{utxoList:m.map(C=>{let g=(0,gt.pick)(C,["vout","nftId","txHash","status","coinAmount"]);return o!==Z.PSBT?g.unlockUtxo=C?.utxoStatusType===1:g.unlockUtxo=!0,g}),address:e,txType:n,coinId:t});if(!d?.length&&!x?.length){l();return}let f=d?.map(C=>{let[g,...F]=C.protocolAssetList;return g.image=p[C.txHash]||a.image,{...C,mainAsset:g,protocolAssetList:F}})||[],h=x?.map(C=>{let g=Ve(C.coinAmount,K.pow(10,u.decimals||0));return C.mainAsset={tokenSymbol:u.symbol,tokenAmount:g,usdAmount:Ge(g,u.usdPrice||0),image:u.image},C})||[],U=ce.action({windowStyle:{width:"100%",height:"100%",maxHeight:"none"},alignBottom:!0,hideCloseBtn:!0,noContentPadding:!0,children:N.default.createElement(dt,{coin:a,selectedCurrency:i,coinToCurrencyFn:c,protocolId:s,conflictAssetUtxo:f,unlockFeeUtxo:h,txType:n,onConfirm:()=>{l(),U.destroy()},onCancel:()=>{_(new Error(Be)),U.destroy()},psbtTitle:o=Z.PSBT?y("extension_defi_top_toast_all_spent"):""})})}catch(d){console.log(d),Ke.error(y("extension_defi_toast_textarea_create_order_fail")),_(new Error(Be))}})()})})},Lt=({address:e,coinId:t,currencyId:s,txType:n=Ne.TRANS_OUT,protocolId:o,doubleConfirmSource:a=Z.TRANSFER})=>{let u=$t({address:e,coinId:t,protocolId:o,txType:n,currencyId:s,doubleConfirmSource:a}),i=Zt(e,t),r=ut();return L(async(c,m=yt.default)=>{try{return a===Z.TRANSFER&&(await i(m),await r(c,m)),await u(c),Promise.resolve()}catch(p){return Promise.reject(p)}})};function Ct(e){return JSON.stringify({ecdsaShare2:ze(e)})}async function ht(e,t,{share:s,pShare:n,mpcId:o,deriveIndex:a}){let{networks:u}=await me(),i=oe(),r=await i.exec("inscribeForMPCUnsigned",[t,u.bitcoin]),{commitTx:c,signHashList:m}=r;t.commitTx=c;let p={currency:k.Currency.BTC,baseChain:Ce,share:s,pShare:n,mpcId:o,signHashList:m,deriveIndex:a},l=await ue().mpcSignTransaction(e,Ce,p),_=JSON.parse(l).signatures;t.signatureList=_;let d=await i.exec("inscribeForMPCSigned",[t,u.bitcoin]);return delete d.signHashList,d}var Do=e=>{let t=Ue(),s=Pe(),n=Ie(),o=(0,N.useCallback)((r,c,m="text/plain;charset=utf-8")=>{let p=[];return r.forEach(l=>{let _={...l};_.contentType||(_.contentType=m),_.revealAddr||(_.revealAddr=c),p.push(_)}),p},[]),a=(0,N.useCallback)(r=>{let c=n(r),{share:m,pShare:p,mpcId:l,publicKey:_,deriveIndex:d}=c?.addressType?.bitcoin?.find(x=>x?.addressType===c?.selectedAddressType?.bitcoin)||{};return{publicKey:_,share:m,pShare:p,mpcId:l,deriveIndex:d}},[]),u=(0,N.useCallback)(async(r,c)=>{let p=(await s(r))?.find(l=>l.address===c)?.privateKey;if(t){let{getRandomPrivateKey:l,getMidKey:_}=await ee(),{networks:d,private2Wif:x}=await me();if(e===W.CAL_FEE)return await l(k.Currency.BTC);if(e===W.CONFIRM){let{share:f}=a(r),h=await _(Ct(f),k.Currency.BTC);return x(w.Buffer.from(h),d.bitcoin)}}return p},[]);return(0,N.useCallback)(async({walletId:r,address:c,tx:m={},privateKey:p})=>{let l=p;l||(l=await u(r,c));let{publicKey:_}=a(r),d=oe(),{commitTxPrevOutputList:x,commitFeeRate:f,revealFeeRate:h,inscriptionData:U,inscriptionDataList:C,revealOutValue:g=546,changeAddress:F=c,toAddr:B}=m,D={commitTxPrevOutputList:x.map(H=>({...H,privateKey:l,publicKey:_,address:c})),commitFeeRate:f,revealFeeRate:h||f,inscriptionData:U,inscriptionDataList:o(C,B||c),revealOutValue:g,changeAddress:F,type:1};if(e===W.CONFIRM&&t){let H=a(r);return await ht(r,D,H)}return await d.exec("signTransaction",[k.Currency.BTC,{data:D}])},[u,a,o,t,e])},Ko=e=>{let t=Ue(),s=Pe(),n=Ie(),o=(0,N.useCallback)(i=>{let r=n(i),{share:c,pShare:m,mpcId:p,publicKey:l,deriveIndex:_}=r?.addressType?.bitcoin?.find(d=>d?.addressType===r?.selectedAddressType?.bitcoin)||{};return{publicKey:l,share:c,pShare:m,mpcId:p,deriveIndex:_}},[]),a=(0,N.useCallback)(async(i,r)=>{let m=(await s(i))?.find(p=>p.address===r)?.privateKey;if(t){let{getRandomPrivateKey:p,getMidKey:l}=await ee(),{networks:_,private2Wif:d}=await me();if(e===W.CAL_FEE)return await p(k.Currency.BTC);if(e===W.CONFIRM){let{share:x}=o(i),f=await l(Ct(x),k.Currency.BTC);return d(w.Buffer.from(f),_.bitcoin)}}return m},[]);return(0,N.useCallback)(async({walletId:i,address:r,tx:c={},privateKey:m,mintType:p=Se.parallel})=>{let l=m;l||(l=await a(i,r));let{publicKey:_}=o(i),d=oe(),{input:x,outValue:f,inscriptions:h}=c,U=x.map(Y=>({...Y,privateKey:l,publicKey:_,address:r})),C={type:X.RUNEMAIN,inputs:U,outputs:[{address:r,amount:f,data:h[0]}],runeData:{etching:null,useDefaultOutput:!1,defaultOutput:0,burn:!1,mint:!0,mintNum:h.length,serialMint:p===Se.serial},...c},{estimateFee:g}=await ee(),F=await g(k.Currency.BTC,{data:C});if(h.length===1&&(F=[F]),e===W.CONFIRM&&t){let Y=o(i),D=await ht(i,C,Y);return{commitTx:D[0],revealTxs:D.slice(1),commitAddrs:[],commitTxFee:F[0],revealTxFees:F.slice(1)}}let B=await d.exec("signTransaction",[k.Currency.BTC,{data:C,privateKey:l}]);return h.length===1&&(B=[B]),{commitTx:B[0],revealTxs:B.slice(1),commitAddrs:[],commitTxFee:F[0],revealTxFees:F.slice(1)}},[a,o,t,e])},Ft=({type:e,toAddr:t,fromAddr:s,walletId:n,satBytes:o,inscriptionData:a,inscriptionDataList:u,revealOutValue:i=790})=>{let r=ne(),m=ot(n||r),p=(0,N.useMemo)(()=>(m||[]).find(({address:l})=>l===s)?.privateKey,[s,m]);return(0,N.useCallback)(async({utxoList:l})=>{let _=ft({type:e,toAddr:t,satBytes:o,fromAddr:s,utxoList:l,privateKey:p,revealOutValue:i,inscriptionData:a,inscriptionDataList:u});try{return await oe().exec("signTransaction",[k.Currency.BTC,{data:_}])}catch{throw Error("sign error")}},[e,t,o,s,p,i,a,u])},zt=({type:e,toAddr:t,fromAddr:s,walletId:n,satBytes:o,inscriptionData:a,inscriptionDataList:u,revealOutValue:i=M,onlyCommitTxFee:r})=>{let c=Ft({type:e,toAddr:t,fromAddr:s,walletId:n,satBytes:o,revealOutValue:i,inscriptionData:a,inscriptionDataList:u});return(0,N.useCallback)(async({utxoList:m,...p})=>{let{commitTxFee:l,revealTxFees:_=[]}=await c({utxoList:m,...p});return r?l:{commitTxFee:l,totalRevealTxFee:(_||[]).reduce((d,x)=>K.add(d,x),0)}},[r,c])},Qt=({type:e,coinId:t,fromAddr:s,toAddr:n,satBytes:o,coinAmount:a,protocolId:u})=>{let r=j(t)?.baseCoinId||t;return(0,N.useCallback)(async({utxoList:c,...m})=>{if(!Number(o))return Promise.reject();let{estimateFee:p}=await ee(),l=pe({type:e,toAddr:n,utxoList:c,satBytes:o,coinAmount:a,protocolId:u,changeAddr:s,...m}),d=Xe({coinId:+r})?.coinType;try{return await p(d,{data:l})}catch(x){return Promise.reject(x)}},[r,a,s,u,o,n,e])},de=({coinId:e,fromAddr:t,toAddr:s,satBytes:n,coinAmount:o,protocolId:a,revealOutValue:u,inscriptionData:i,inscriptionDataList:r,...c})=>{let m=ve(a),p=Qt({coinId:e,satBytes:n,fromAddr:t,toAddr:s,coinAmount:o,protocolId:a,type:m,...c}),l=zt({coinId:e,toAddr:s,fromAddr:t,satBytes:n,coinAmount:o,protocolId:a,revealOutValue:u,inscriptionData:i,inscriptionDataList:r,type:m,onlyCommitTxFee:!0,...c});return a===T.SRC_20?l:p},Ot=(e,t)=>{let{coinId:s,walletId:n,toAddr:o,fromAddr:a,satBytes:u,networkFee:i,coinAmount:r,canTransferAmount:c,utxoParams:m={},inscriptionData:p,protocolId:l,inscriptionDataList:_,revealOutValue:d=M,inputs:x,...f}=e,h=j(s),U=h?.baseCoinId===0,C=l||h?.protocolId,{ready:g=!0,refreshDeps:F}=t||{},[B,{setTrue:Y,setFalse:D}]=le(!1),[ke,H]=(0,N.useState)(),Le=ne(),Nt=n||Le,[fe,St]=(0,N.useState)(i),Oe=de({coinId:s,fromAddr:a,toAddr:o,satBytes:u,coinAmount:r,protocolId:C,revealOutValue:d,inscriptionData:p,inscriptionDataList:_}),je={coinAmount:r,networkFee:fe||"0"};U&&c&&K.gt(K.add(r,fe),c)&&(je={coinAmount:c,networkFee:0});let[It,se]=ct({coinId:s,address:a,walletId:Nt,...je,...m},{refreshDeps:F,ready:U&&!!c&&g||!U&&g}),Te=(0,N.useMemo)(()=>[...x||[],...se||[]],[x,se]);return tt(()=>{!Array.isArray(Te)||!Te?.length||(Y(),Oe({utxoList:Te,...f}).then(ae=>{H(!1),St(ae),t?.onSuccess?.(ae,se)}).catch(ae=>{H(!0),t?.onError?.(ae)}).finally(()=>{D()}))},[se,f,Oe]),[B||It,fe,ke]},en=({type:e,coinId:t,toAddr:s,walletId:n,fromAddr:o,changeAddr:a,satBytes:u,localType:i,coinAmount:r,networkFee:c,protocolId:m,dustSize:p=M,...l})=>{let _=ne(),x=Ae({fromAddr:o,localType:i,walletId:n||_});return(0,N.useCallback)(async({utxoList:f,...h})=>{let U=pe({toAddr:s,satBytes:u,type:e,changeAddr:a||o,dustSize:p,coinAmount:r,utxoList:f,protocolId:m,...l});return await x({params:U,...h})},[a,r,p,o,m,l,u,x,s,e])},mt=({coinId:e,toAddr:t,walletId:s,protocolId:n,fromAddr:o,changeAddr:a,satBytes:u,localType:i,coinAmount:r,networkFee:c,inscriptionData:m,inscriptionDataList:p,dustSize:l=M,..._})=>{let d=ve(n),x=en({coinId:e,toAddr:t,walletId:s,fromAddr:o,changeAddr:a,satBytes:u,localType:i,coinAmount:r,networkFee:c,dustSize:l,protocolId:n,type:d,..._}),f=Ft({toAddr:t,fromAddr:o,walletId:s,satBytes:u,protocolId:n,inscriptionData:m,inscriptionDataList:p,type:d,..._});return n===T.SRC_20?f:x},jt=({coinId:e,toAddr:t,txType:s,fromAddr:n,satBytes:o,walletId:a,localType:u,networkFee:i,coinAmount:r,protocolId:c,dustSize:m=M,extraPublishParams:p={},...l})=>{let _=ne(),d=a||_,x=mt({coinId:e,toAddr:t,walletId:a,fromAddr:n,satBytes:o,localType:u,coinAmount:r,networkFee:i,dustSize:m,protocolId:c,...l}),f=be({coinId:e,txType:s,coinAmount:r,fromAddr:n,toAddr:t,localType:u,networkFee:i,walletId:d,extJson:JSON.stringify({protocolId:c}),...p});return(0,N.useCallback)(async({utxoList:h,...U})=>{let C=await x({utxoList:h,...U}),g=C;return c===T.SRC_20&&(g=C?.commitTx),await f(g)},[c,f,x])};export{it as a,V as b,W as c,Z as d,Yt as e,re as f,Vt as g,_e as h,ct as i,vt as j,kt as k,Lt as l,Do as m,Ko as n,de as o,Ot as p,mt as q,jt as r};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-N3VGDA3L.js.map
