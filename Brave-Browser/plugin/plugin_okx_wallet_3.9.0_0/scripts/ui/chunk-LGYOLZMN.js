import{a as le,b as ce}from"./chunk-PFNFAQEP.js";import{b as ie}from"./chunk-MTAR53YL.js";import{b as Xt,f as Qt,h as te,k as ee,l as oe,p as se,q as re}from"./chunk-N3VGDA3L.js";import{a as $t}from"./chunk-DZDHGH5B.js";import{d as Jt}from"./chunk-UKFSUXAE.js";import{a as ae}from"./chunk-SIKYZQW4.js";import{c as ne,d as tt,e as et,g as P}from"./chunk-YZAK46Y6.js";import{a as Zt,e as R}from"./chunk-7ODXCTBK.js";import{b as Kt}from"./chunk-C54I6GL3.js";import{e as Q}from"./chunk-UIABO6UG.js";import{i as zt,l as Vt,m as Gt}from"./chunk-FFQESTX4.js";import{f as Tt}from"./chunk-X6EEBMFW.js";import{b as pt}from"./chunk-IZ5XPPXG.js";import{q as _t,r as qt}from"./chunk-EKQH7XTV.js";import{d as yt}from"./chunk-2LLM6N6U.js";import{b as ft}from"./chunk-AO6MUSOH.js";import{a as Ht}from"./chunk-I435LZHT.js";import{x as A}from"./chunk-SJIW4WAV.js";import{l as Yt,o as jt,y as Rt}from"./chunk-5JJQQHKZ.js";import{a as X}from"./chunk-URG4MCPH.js";import{y as We}from"./chunk-ZPOCIBPN.js";import{T as K,b as $,ba as vt}from"./chunk-CA5MYYD6.js";import{a as Me}from"./chunk-IOCZ22XI.js";import{c as N}from"./chunk-VMYDP774.js";import{a as q,b as Wt}from"./chunk-A7LNVEYU.js";import{f as Z,h as Ut}from"./chunk-2YWUVAR3.js";import{$b as Mt,Ka as Dt,Pa as Ue,Ub as J,a as Bt,b as ke,gc as j,la as De,m as Oe,q as Ot}from"./chunk-M54COW6Q.js";import{G as kt,b as Pt,o as St}from"./chunk-RIJWHGTU.js";import{I as G,l as B,v as d}from"./chunk-K4MPEKC5.js";import{a as M}from"./chunk-CXUPEGDW.js";import{f as C,m as c,o as m}from"./chunk-ICCOEXX5.js";c();m();var t=C(M()),be=C(We()),Ce=C(Me());var Ne=C(Oe());G();Ue();c();m();var g=C(M());G();c();m();var me={list:"_list_shbob_1"};var ve=({coinId:e,value:n,visible:o,onToggleVisible:a,options:p,onChange:i})=>{let f=Q(e),I=b=>{let{addressType:_,address:E,canTransferAmount:F}=b;return g.default.createElement(yt.Card,{selected:n?.address===E,onClick:()=>{a?.(),i?.(b)}},g.default.createElement(N.Box,{style:{width:"100%"}},g.default.createElement(N.FlexBox,{justify:"space-between",align:N.ALIGN.center},g.default.createElement(A.Text,{strong:!0},d(J[_])),g.default.createElement(A.DisplayAmount,{strong:!0,mode:A.CRYPTO,decimals:f?.decimals},F)),g.default.createElement(N.FlexBox,{justify:"space-between",align:N.ALIGN.center},g.default.createElement(A.Address,{address:E,desensitize:!0,copyable:!1,size:A.SIZE.sm,type:A.TYPE.secondary}),g.default.createElement(A.Text,{type:A.TYPE.secondary,size:A.SIZE.xs},d("nftmarket_general_wallet_label_available")||"Available BTC"))))};return g.default.createElement(St,{visible:o,alignBottom:!0,noTopRadius:!1,windowStyle:{width:"100%"},title:d("btcnft_gas_title_pay_gas_with"),onClose:a},g.default.createElement(yt,{space:16,dataSource:p,renderItem:I,className:me.list}))},ue=ve;c();m();ke();var de=C(M()),Ye=()=>(0,de.useCallback)(({value:e,message:n,reportParams:o})=>{try{Bt.captureEvent({message:n,contexts:{report:{info:JSON.stringify(o)}},exception:{values:[{type:"BIZ_ERROR_btcPayWalletAddress",value:e}]},level:"warn"})}catch(a){console.log(a)}},[]),fe=Ye;c();m();var H=C(M());Ut();Wt();function je(e,n,o){let[a,p]=(0,H.useState)(o),[i,f]=(0,H.useState)([]);return(0,H.useEffect)(()=>{(async()=>{try{if(!o)return;let b=await Z(q.checkDustForBtcTx,{inscriptionIds:n,targetAddress:e,scene:24});f(b?.data?.dustInscriptionIds||[])}finally{p(!1)}})()},[o,e,n]),{isDustLoading:a,dustError:i.length>0}}var pe=je;c();m();var ye=C(M());G();var Re=({isMpcWallet:e,isHardware:n,feeError:o,isSufficientGas:a,dustError:p,transferReminder:i})=>({tipMessageProps:(0,ye.useMemo)(()=>e?{type:P.TIP_TYPE.COMMON_ERROR,message:d("extension_wallet_contractual_interaction_wallet_unavailable")}:n?{type:P.TIP_TYPE.COMMON_ERROR,message:d("wallet_extension_top_toast_dapp_comingsoon")}:o?{type:P.TIP_TYPE.FEE_ERROR}:a?p?{type:P.TIP_TYPE.COMMON_ERROR,message:d("wallet_info_dialog_dust_limit_individually")}:{type:Pt.TYPE.warn,message:i}:{type:vt.FEE_BALANCE_INSUFFICIENT},[o,e,n,a,p,i])}),_e=Re;c();m();Ut();Wt();var He=e=>{let{loading:n,data:o}=Yt(async()=>(await Z(q.batchBtcNftDetail,{inscriptionIdProtocols:Array.isArray(e)?e:[e]}))?.data?.details||[]);return[n,o||[]]},Te=He;c();m();var gt=C(M());G();De();var ze=7*1e3,Ve=({walletId:e,coinId:n,satBytes:o,needFilteredUtxo:a})=>{let p=zt(e),i=(0,gt.useMemo)(()=>p?.addressType?.[Ot]||[],[p?.walletId]),[f,I]=ee({coinId:n,walletId:e,satBytes:o,addressList:i?.map(({address:_})=>_),needFilteredUtxo:a},{pollingInterval:ze,ready:!!a?.length&&!!o}),b=(0,gt.useMemo)(()=>i.map((E,F)=>({...E,canTransferAmount:I[F]}))?.sort((E,F)=>{let S=B.sub(F.canTransferAmount,E.canTransferAmount);return Number(S)}),[I,i]);return[f,b]},ge=Ve;c();m();var xt={"nft-transfer__extend":"_nft-transfer__extend_1bjoo_1",nftTransferExtend:"_nft-transfer__extend_1bjoo_1","nft-transfer__icon":"_nft-transfer__icon_1bjoo_4",nftTransferIcon:"_nft-transfer__icon_1bjoo_4"};var xe={Ordinals:"Ordinals",Atomicals:"Atomicals"},Ae=2,Ie="NFT",ws=({unapproved:e})=>{let n=e?.walletId,o=Dt,a=Q(o),p=Gt(n),i=e.params.transfer.from,f=e.params.transfer.to,{feeRate:I}=e.params.transfer.options||{},b=fe(),[,_]=$t({coinId:o,address:i,chainId:a?.chainId}),E=_?.transferReminder,[F,S]=Rt({payWallet:!1,networkFee:!1}),[w,At]=(0,t.useState)(I&&typeof I=="number"?{satBytes:I,level:K.CUSTOM}:{satBytes:_?.normal,level:K.STANDARD});(0,t.useEffect)(()=>{!w?.satBytes&&_?.normal&&At({satBytes:_?.normal,level:K.STANDARD})},[_,w]);let z=e.params.transfer.data,k=Array.isArray(z)&&z.length>1,{isDustLoading:It,dustError:ot}=pe(f,z,k),[,l]=Te(z),v=(0,t.useMemo)(()=>{if(!Array.isArray(l)||!l?.length)return;let[{protocol:r}]=l||[];if(r===xe.Atomicals)return j.ARC_20},[l]),st=(0,t.useMemo)(()=>l.map(r=>`${r.btcNftUtxoDetail?.txId}-${r.btcNftUtxoDetail?.outputIndex}`),[l]),[bt,O]=ge({coinId:o,walletId:n,needFilteredUtxo:st,satBytes:w?.satBytes}),[s,rt]=(0,t.useState)({}),[nt,{toggle:Ee}]=jt(!1);(0,t.useEffect)(()=>{let r=O?.[0];if((0,Ne.isEmpty)(s)&&!!r&&r?.canTransferAmount&&rt(r),O&&s.address&&s?.canTransferAmount){let u=O.find(({address:y})=>y===s?.address);u||b({value:u,reportParams:{payWallet:s,payWallets:O},message:`payWallet address get ${u}`}),u&&rt(u)}},[b,s,O]);let Y=(0,t.useMemo)(()=>l.map(r=>{let{tokenId:u,protocol:y}=r,{txId:U,outputIndex:W,outputValue:Se}=r?.btcNftUtxoDetail||{},Lt={txHash:U,nftId:r.tokenId,status:1,address:i,vout:Number(W),coinAmount:Number(Se),resourceUrl:r?.resourceUrl};return y===xe.Atomicals&&Object.assign(Lt,{data:[{atomicalId:u,type:Ie,amount:1}]}),Lt}),[i,l]),Ct=(0,t.useMemo)(()=>l.map(r=>{let u=r?.tokenId,{outputValue:y}=r?.btcNftUtxoDetail||{},U=Number(y);k||(U=B.lt(y,546)?546:Number(y));let W={amount:U,address:f};return v===j.ARC_20&&Object.assign(W,{data:[{atomicalId:u,type:Ie,amount:1}]}),W}),[k,l,v,f]),at=(0,t.useMemo)(()=>{if(!k){let{outputValue:r=0}=l?.[0]?.btcNftUtxoDetail||{};if(r<546)return B.sub(546,r)}return 0},[k,l]),[it,T,V]=se({coinId:o,protocolId:v,toAddr:f,coinAmount:at,fromAddr:s?.address,satBytes:w?.satBytes,utxoParams:{satBytes:w?.satBytes,needFilteredUtxo:st},canTransferAmount:s?.canTransferAmount,inputs:Y,outputs:Ct},{ready:!!Y?.length}),lt=k?$.BTC_NFT_BULK_SEND:$.SEND_NFT,Nt=re({coinId:o,walletId:n,protocolId:v,coinAmount:0,toAddr:f,fromAddr:i,changeAddr:s?.address,localType:a?.localType,dustSize:v===j.ARC_20?void 0:_?.minOutput,networkFee:T,satBytes:w.satBytes,inputs:Y,outputs:Ct}),ct=l.map(({tokenId:r})=>r),Fe=JSON.stringify({nftIds:ct,from:i,to:f,serviceCharge:T,gasFrom:s?.address}),Et=Jt({coinId:o,txType:lt,walletId:n,coinAmount:0,fromAddr:i,toAddr:f,networkFee:T,localType:a?.localType,extJson:Fe,txSource:Mt.NFT}),Ft=te({coinId:o,walletId:n,address:s.address,utxoType:Xt.TRANSFER,satBytes:w?.satBytes,needFilteredUtxo:st}),x=(0,be.useDispatch)(),L=(0,Ce.useHistory)(),wt=oe({coinId:o,txType:$.SEND_NFT,protocolId:j.BRC_NFT,address:s.address}),mt=l?.length,we=(0,t.useMemo)(()=>(l?.slice(0,nt?mt:Ae)).map(({resourceUrl:u,name:y})=>({title:y,icon:{src:u}})),[l,nt,mt]),D=(0,t.useMemo)(()=>!(s?.canTransferAmount&&B.lt(s?.canTransferAmount,B.add(T,at))),[T,at,s?.canTransferAmount]),he=Vt(n),[Le,ut]=(0,t.useState)(!1),dt=(0,t.useCallback)(async()=>{e.id?(await x(_t(e.id)),await x(pt()),L.push(X)):(x(Tt()),D?L.goBack():L.replace(X)),ut(!1)},[x,L,D,e.id]),{tipMessageProps:Be}=_e({isHardware:p,feeError:V,isSufficientGas:D,dustError:ot,transferReminder:E}),ht=(0,t.useCallback)(async()=>{if(!await Kt({walletId:n,callback:async()=>{await x(_t(e.id))}}))return;let u=await Ft(0,T);await wt([...Y,...u],dt),ut(!0);let y=await Nt({utxoList:[],utxos:[{address:s.address,inputs:Qt(u)}]}),U=await Zt(a?.localType,y);try{e.id?(await x(qt(e.id,{txHash:U,signedTx:y,serviceCharge:T,gasFrom:s.address,txType:lt,nftIds:ct})),await x(pt())):(await Et(y),x(Tt()),kt.success({title:d("wallet_transfer_notif_transaction_submit")})),L.push(X)}catch(W){console.log(W)}finally{ut(!1)}},[dt,wt,a?.localType,x,T,Ft,L,D,ct,s.address,Et,Nt,Y,lt,e.id]),Pe=(0,t.useMemo)(()=>{let r={actionType:R.ACTION_TYPE.CANCEL,btnText:d("wallet_dapp_connection_btn_reject"),onClick:dt},u={disabled:bt||it||V||p||!Number(T)||!l?.length||It||ot,actionType:R.ACTION_TYPE.CONFIRM,onClick:ht};return D||(u={coinId:o,walletId:n,address:s?.address,actionType:R.ACTION_TYPE.FILL_UP}),[r,u]},[bt,it,V,p,T,l?.length,ht,D,e.id,x,L,o,n,s?.address,It,ot]);return t.default.createElement(N.Box,null,t.default.createElement(tt,null,t.default.createElement(ne,{space:24,title:d("wallet_extension_send_colored_send"),summaryList:we}),mt>Ae&&t.default.createElement(N.FlexBox,{justify:"center",className:xt["nft-transfer__extend"],onClick:Ee},t.default.createElement(ft,{size:ft.SIZE.xs,className:xt["nft-transfer__icon"],icon:nt?"okds-arrow-chevron-up-md":"okx-wallet-plugin-add-arrow-chevrons"}))),t.default.createElement(tt,null,t.default.createElement(et,{walletId:n,address:i,title:d("extension_send_mid_text_from")}),t.default.createElement(et,{address:f,title:d("extension_send_mid_text_to")})),t.default.createElement(tt,null,t.default.createElement(ae,{coinId:o,loading:it,estimateFailed:V,networkFee:T,onClick:()=>{S({networkFee:!0})}}),t.default.createElement(et,{copyable:!1,address:s?.address,addressType:s?.addressType,title:d("btcnft_gas_label_pay_gas_with"),tags:[d(J[s?.addressType])],onClick:()=>{S({payWallet:!0})}},t.default.createElement(le,{coinBalance:s.canTransferAmount}))),t.default.createElement(ue,{coinId:o,value:s,options:O,visible:F.payWallet,onChange:rt,onToggleVisible:()=>{S({payWallet:!1})}}),t.default.createElement(Ht,{offsetBottom:0,placeholder:!0,borderTop:!0},t.default.createElement(P,{coinId:o,...Be}),t.default.createElement(R,{buttonGroup:Pe})),t.default.createElement(ie,{coinId:o,signInfo:_,visible:F?.networkFee,value:w,estimatedFee:T,onChange:At,onToggleVisible:()=>{S({networkFee:!1})}}),t.default.createElement(ce,{visible:he&&Le}))};export{ws as a};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-LGYOLZMN.js.map
